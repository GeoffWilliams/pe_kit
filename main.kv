#:kivy 1.0
#
# Copyright 2016 Geoff Williams for Puppet Inc.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# Example of how to turn on widget borders for debugging layouts
#<Widget>:
#    canvas.after:
#        Line:
#            rectangle: self.x+1,self.y+1,self.width-1,self.height-1
#            dash_offset: 5
#            dash_length: 3

ScreenManagement:
    MainScreen:
    SettingsScreen:
  
<MainScreen>:
    name: 'main'
    
    # prevent errors due to weak reference being GC'ed
    # see https://kivy.org/docs/guide/lang.html
    advanced_layout: advanced_layout.__self__
    advanced_layout_holder: advanced_layout_holder
    app_status_label: app_status_label
    container_status_label:container_status_label
    container_delete_image: container_delete_image
    docker_status_image: docker_status_image
    action_layout_holder: action_layout_holder
    action_layout: action_layout.__self__
    pe_status_image: pe_status_image
    console_button: console_button
    terminal_button: terminal_button
    
    BoxLayout:
        orientation: 'vertical'
        padding: 20
        
        BoxLayout:
            size_hint: (1, 0.2)
            
            # PE Kit banner
            AnchorLayout:
                size_hint: (0.8, 1) 
                Label:
                    text: 'PE Kit'
                    font_size: '40sp'
                             
            # settings
            #AnchorLayout:
            Button:
                size_hint: (None, None)
                border: (0, 0, 0, 0)
                on_release: app.root.current = 'settings'
                background_normal: 'icons/settings.png'
                    
        BoxLayout:
            id: action_layout_holder
            BoxLayout:
                id: action_layout
                orientation: 'vertical'
                # console
                BoxLayout:
                    Button:
                        id: console_button
                        text: 'Console'
                        on_press: app.pe_console()
                        disabled: True

                    # terminal
                    Button:
                        id: terminal_button
                        text: 'Terminal'
                        on_press: app.pe_terminal()

                #
                # Advanced
                #
                Button:
                    text: 'Toggle advanced actions'
                    on_release: root.toggle_advanced()
                    size_hint: (0.4, 0.5)

                BoxLayout:
                    id: advanced_layout_holder

                    BoxLayout:
                        id: advanced_layout

                        # run puppet
                        Button:
                            text:  'Run Puppet'
                            on_release: root.run_puppet()

                        # dockerbuild
                        Button:
                            text: 'Dockerbuild'
                            on_release: root.dockerbuild()

        #
        # Status
        #
        GridLayout:
            cols: 6
            size_hint: (1, 0.2)
            
            Label:
                text: 'Status:'
                size_hint: (0.2, 1)
            Label:
                id: app_status_label
                text: '...'
                size_hint: (0.2, 1)
            Label:
                id: container_status_label
                text: '...'
                size_hint: (0.4, 1)
            # start/stop container
            Button:
                id: container_delete_image
                on_release: app.controller.toggle_docker_container()
                size_hint_y: None
                size_hint_x: None
                border: (0, 0, 0, 0)
                background_normal: 'icons/blank.png'

            Button:
                id: pe_status_image
                size_hint_y: None
                size_hint_x: None
                background_normal: 'icons/blank.png'
                border: (0, 0, 0, 0)
                on_release: root.pe_status_info()

            Button:
                id: docker_status_image
                size_hint_y: None
                size_hint_x: None
                background_normal:  'icons/blank.png'
                border: (0, 0, 0, 0)
                on_release: root.docker_status_info()

            
<SettingsScreen>:
    name: 'settings'

    # widget/class variable mapping
    image_management_layout: image_management_layout
    use_latest_image_checkbox: use_latest_image_checkbox
    start_automatically_checkbox: start_automatically_checkbox
    kill_orphans_checkbox: kill_orphans_checkbox
    shutdown_on_exit_checkbox: shutdown_on_exit_checkbox
    expose_ports_checkbox: expose_ports_checkbox

    BoxLayout:
        orientation: 'vertical'
        size_hint: (1, 1)
        
        # banner
        Label:
            text: 'Image management'
            font_size: '40sp'
            size_hint: (1, 0.2)

        # Image Management     
        GridLayout:
            id: image_management_layout
            cols: 3
            cols_minimum: { 0: dp(700), 1: dp(25), 2: dp(25)}
            row_default_height: dp(25)

        #
        # Checkboxes/Settings file
        # 
        # banner
        Label:
            text: 'Settings'
            font_size: '40sp'
            size_hint: (1, 0.2)

        # use latest image
        GridLayout:
            cols: 2
            
            CheckBox:
                id: use_latest_image_checkbox
            Label:
                text: 'Use latest image'
        
            # start automatically
            CheckBox:
                id: start_automatically_checkbox
            Label:
                text: 'Start container automatically'
            
            # kill orphans
            CheckBox:
                id: kill_orphans_checkbox
            Label:
                text: 'Kill orphaned containers on startup'
                
            # Shutdown on exit
            CheckBox:
                id: shutdown_on_exit_checkbox
            Label:
                text: 'Shutdown PE on on exit'
           
            # Expose puppet and mcollective ports through docker
            CheckBox:
                id: expose_ports_checkbox
            Label:
                text: 'Expose Puppet and MCollective ports'
                               
        Button:
            on_release: root.back()
            text: 'Back'
            size_hint: (1, 0.2)
